import json
import os

# 获取项目根目录的绝对路径
PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

# 确保数据目录存在
data_dir = os.path.join(PROJECT_ROOT, 'data')
os.makedirs(data_dir, exist_ok=True)

# 创建训练集
training_data = [
    # 保留一些好的基础样本
    {
        "text": "至廣信，有書致唐龍",
        "labels": [0, 1, 2, 0, 0, 0, 0, 0, 0]
    },
    {
        "text": "遊西湖，至孤山",
        "labels": [0, 1, 2, 0, 0, 1, 2]
    },
    # 添加带后缀的地名样本
    {
        "text": "遊寒山寺，訪普濟寺",
        "labels": [0, 1, 2, 2, 0, 0, 1, 2, 2]  # 寺是地名的一部分
    },
    {
        "text": "至西興鎮，過臨安縣",
        "labels": [0, 1, 2, 2, 0, 0, 1, 2, 2]  # 鎮、縣是地名的一部分
    },
    # 添加人名与地名混合的例子
    {
        "text": "謁紫凝真人於天台山",
        "labels": [0, 0, 0, 0, 0, 0, 1, 2, 2]  # 紫凝真人不是地名
    },
    {
        "text": "訪林和靖於孤山",
        "labels": [0, 0, 0, 0, 0, 1, 2]  # 林和靖不是地名
    },
    # 添加江河湖海样本
    {
        "text": "過錢塘江，遊西湖",
        "labels": [0, 1, 2, 2, 0, 0, 1, 2]
    },
    {
        "text": "至富春江畔",
        "labels": [0, 1, 2, 2, 0]
    },
    # 添加完整寺庙名称
    {
        "text": "遊靈隱寺，至天竺寺",
        "labels": [0, 1, 2, 2, 0, 0, 1, 2, 2]
    },
    {
        "text": "過淨慈寺，登雷峰塔",
        "labels": [0, 1, 2, 2, 0, 0, 1, 2, 2]
    },
    # 添加方位地名
    {
        "text": "由錢塘往西興",
        "labels": [0, 1, 2, 0, 1, 2]  # 分开的两个地名
    },
    {
        "text": "自杭州至蘇州",
        "labels": [0, 1, 2, 0, 1, 2]
    },
    # 添加复杂地名组合
    {
        "text": "遊虎丘山寺，登雲岩寺塔",
        "labels": [0, 1, 2, 2, 2, 0, 0, 1, 2, 2, 2]
    },
    {
        "text": "至石梁飛渡",
        "labels": [0, 1, 2, 2, 2]  # 完整景点名
    },
    # 添加容易混淆的例子
    {
        "text": "望潮信至，遊江潮亭",
        "labels": [0, 0, 0, 0, 0, 0, 1, 2, 2]
    },
    {
        "text": "訪延慶長老於靈隱寺",
        "labels": [0, 0, 0, 0, 0, 0, 1, 2, 2]
    },
    # 加行政区划样本
    {
        "text": "過臨安府，入錢塘縣",
        "labels": [0, 1, 2, 2, 0, 0, 1, 2, 2]
    },
    # 新增训练样本
    {
        "text": "應內召起程北上赴京。唐龍、嚴嵩皆有詩文送之",
        "labels": [0, 0, 0, 0, 0, 0, 0,0,1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    },
    {
        "text": "奉世宗馳驛來京敕詔",
        "labels": [0, 0, 0, 0, 0, 0, 1, 0, 0]
    },
    # 从图片中选择的样本
    {
        "text": "追劉內史楊充江。力命招助",
        "labels": [0, 0, 0, 0, 1, 2, 2, 0, 0, 0, 0, 0]
    },
    {
        "text": "追劉內史楊充江。力命招助南衙山左右兵民",
        "labels": [0, 0, 0, 0, 1, 2, 2, 0, 0, 0, 0, 0, 1, 2, 2, 0, 0, 0, 0]
    },
    {
        "text": "追賊黃洪能，遊青山，巡遊青山城以紀其處",
        "labels": [0, 0, 0, 0, 0, 0,0,1, 2, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0]
    },
    {
        "text": "蔡普隨師，前遊九華山，訪九華山服以供其眾",
        "labels": [0, 0, 0, 0, 0, 0, 0,1, 2, 2, 0, 0, 1, 2, 2, 0, 0, 0, 0,0]
    },
    {
        "text": "蔡普隨師，遊花山功勳寺，舊有貢使圖",
        "labels": [0, 0, 0, 0, 0,0, 1, 2, 2, 2, 2, 0, 0, 0, 0, 0,0]
    },
    {
        "text": "那宜朝廷，經潮州，往惠金山、仙山、北山山，有詩贈三山僧",
        "labels": [0, 0, 0, 0, 0, 0,1, 2, 0, 0, 1, 2, 2, 0, 1, 2, 0, 1, 2, 0, 0, 0, 0, 0, 0,0,0]
    },
    {
        "text": "蘇軾朝，往北山山，府居其處。府詩咏",
        "labels": [0, 0, 0, 0, 0, 1, 2, 2,0, 0, 0, 0, 0, 0, 0, 0,0]
    }
]

# 使用绝对路径保存文件
file_path = os.path.join(data_dir, 'train_data.json')

def validate_data(training_data):
    """验证训练数据的格式是否正确"""
    for item in training_data:
        if len(item["text"]) != len(item["labels"]):
            print(f"错误：文本和标签长度不匹配\n文本：{item['text']}\n长度：{len(item['text'])} vs {len(item['labels'])}")
            return False
    return True

# 在保存之前验证数据
if validate_data(training_data):
    with open(file_path, 'w', encoding='utf-8') as f:
        json.dump(training_data, f, ensure_ascii=False, indent=2)
    print(f"训练数据已保存到 {file_path}")
else:
    print("数据验证失败，请检查文本和标签的长度是否匹配")
